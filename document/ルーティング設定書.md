# LSP System ルーティング設定書

## 概要

本ドキュメントは、LSP System のルーティング設定について説明します。
go_router パッケージを使用した宣言的なルーティング構造を採用しています。

## ルート構造

### 認証関連

#### ログインページ

- **パス**: `/login`
- **説明**: ユーザーログイン画面
- **認証**: 不要
- **実装**: `lib/features/auth/presentation/login_page.dart`

### メイン機能

#### ホームページ

- **パス**: `/home`
- **説明**: アプリケーションのメイン画面、機能メニューを表示
- **認証**: 必要
- **実装**: `lib/features/home/presentation/home_page.dart`

### 労働力計画モジュール

#### 必要人時予測

- **パス**: `/home/workforce-forecast`
- **説明**: 必要な労働時間を予測する機能
- **認証**: 必要
- **実装**: `lib/features/workforce_planning/presentation/workforce_forecast_page.dart`

#### 稼働計画

- **パス**: `/home/operation-plan`
- **説明**: 労働力の稼働計画を管理する機能
- **認証**: 必要
- **実装**: `lib/features/workforce_planning/presentation/operation_plan_page.dart`

#### 作業割当

- **パス**: `/home/work-assignment`
- **説明**: 作業者への作業割り当てを管理する機能
- **認証**: 必要
- **実装**: `lib/features/workforce_planning/presentation/work_assignment_page.dart`

### 作業モデル管理

#### 作業モデル管理

- **パス**: `/home/work-model`
- **説明**: 作業モデルの設定と管理
- **認証**: 必要
- **実装**: `lib/features/work_model/presentation/work_model_page.dart`

### 作業実績進捗管理モジュール

#### 作業実績進捗管理メニュー

- **パス**: `/home/progress`
- **説明**: 作業実績進捗管理のサブメニュー
- **認証**: 必要
- **実装**: `lib/features/progress/presentation/progress_page.dart`

#### 個人作業実績管理

- **パス**: `/home/progress/personal`
- **説明**: 個人の作業実績を管理
- **認証**: 必要
- **実装**: `lib/features/progress/presentation/progress_personal_page.dart`

#### MGR 作業進捗管理

- **パス**: `/home/progress/manager`
- **説明**: マネージャー向けの作業進捗管理
- **認証**: 必要
- **実装**: `lib/features/progress/presentation/progress_manager_page.dart`

#### 作業完了率

- **パス**: `/home/progress/completion-rate`
- **説明**: 作業の完了率を表示
- **認証**: 必要
- **実装**: `lib/features/progress/presentation/progress_completion_rate_page.dart`

### 分析レポートモジュール

#### 分析レポートメニュー

- **パス**: `/home/analytics`
- **説明**: 分析レポートのサブメニュー
- **認証**: 必要
- **実装**: `lib/features/analytics/presentation/analytics_page.dart`

#### 予算計画実績契約分析

- **パス**: `/home/analytics/budget-analysis`
- **説明**: 予算計画、実績、契約の分析
- **認証**: 必要
- **実装**: `lib/features/analytics/presentation/analytics_budget_page.dart`

#### 必要人時と契約差異分析

- **パス**: `/home/analytics/manhour-variance`
- **説明**: 必要な労働時間と契約との差異を分析
- **認証**: 必要
- **実装**: `lib/features/analytics/presentation/analytics_variance_page.dart`

#### 人時生産性

- **パス**: `/home/analytics/productivity`
- **説明**: 労働時間あたりの生産性を分析
- **認証**: 必要
- **実装**: `lib/features/analytics/presentation/analytics_productivity_page.dart`

### デジタル個人サービスモジュール

#### デジタル個人サービスメニュー

- **パス**: `/home/personal-services`
- **説明**: デジタル個人サービスのサブメニュー
- **認証**: 必要
- **実装**: `lib/features/personal/presentation/personal_services_page.dart`

#### 個人計画修正

- **パス**: `/home/personal-services/plan-revision`
- **説明**: 個人の作業計画を修正
- **認証**: 必要
- **実装**: `lib/features/personal/presentation/personal_plan_revision_page.dart`

#### 希望休みや希望時間申請

- **パス**: `/home/personal-services/leave-request`
- **説明**: 休暇や希望時間の申請
- **認証**: 必要
- **実装**: `lib/features/personal/presentation/personal_leave_request_page.dart`

#### 有給・時間変更申請

- **パス**: `/home/personal-services/schedule-change`
- **説明**: 有給休暇や勤務時間の変更申請
- **認証**: 必要
- **実装**: `lib/features/personal/presentation/personal_schedule_change_page.dart`

#### 応募

- **パス**: `/home/personal-services/application`
- **説明**: 各種応募機能
- **認証**: 必要
- **実装**: `lib/features/personal/presentation/personal_application_page.dart`

## 認証フロー

### 認証ガード

アプリケーションは、Riverpod を使用した認証状態管理を実装しています。

```dart
redirect: (context, state) {
  final isLoggedIn = authState;
  final isLoginPage = state.matchedLocation == '/login';

  if (!isLoggedIn && !isLoginPage) {
    return '/login';
  }
  if (isLoggedIn && isLoginPage) {
    return '/home';
  }
  return null;
}
```

### 認証ロジック

- 未ログイン状態でログインページ以外にアクセスすると、自動的にログインページへリダイレクト
- ログイン済みの状態でログインページにアクセスすると、ホームページへリダイレクト

### テストアカウント

- **ユーザー名**: `admin`
- **パスワード**: `admin`

## ルート定数

すべてのルートパスは `lib/shared/constants/route_paths.dart` で定数として定義されています。
これにより、タイプセーフなナビゲーションが可能になります。

## ナビゲーション方法

### 画面遷移

```dart
// context.go を使用した遷移
context.go(RoutePaths.workforceForecast);

// context.push を使用したスタック追加
context.push(RoutePaths.analytics);
```

## 拡張性

新しいルートを追加する場合：

1. `lib/shared/constants/route_paths.dart` にパスを定義
2. `lib/router/app_router.dart` に `GoRoute` を追加
3. 対応するページウィジェットを実装

## 注意事項

- すべての認証が必要なページは、自動的に認証ガードによって保護されています
- ログアウト時は、ローカルストレージの認証情報もクリアされます
- ルートパスは必ず定数を使用し、ハードコードを避けてください
